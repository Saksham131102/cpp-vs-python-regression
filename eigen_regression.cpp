#include <iostream>
#include "Eigen/Dense"
#include <chrono>
#include <vector>

using namespace std;
using namespace Eigen;

int main() {
    auto start = chrono::high_resolution_clock::now();

    // Sample data
    MatrixXd X(50, 8);  // 50 samples, 8 features
    VectorXd y(50);

    // Fill X and y with your data
    X << -122.23,37.88,41,880,129,322,126,8.3252,
         -122.22,37.86,21,7099,1106,2401,1138,8.3014,
         -122.24,37.85,52,1467,190,496,177,7.2574,
         -122.25,37.85,52,1274,235,558,219,5.6431,
         -122.25,37.85,52,1627,280,565,259,3.8462,
         -122.25,37.85,52,919,213,413,193,4.0368,
         -122.25,37.84,52,2535,489,1094,514,3.6591,
         -122.25,37.84,52,3104,687,1157,647,3.12,
         -122.26,37.84,42,2555,665,1206,595,2.0804,
         -122.25,37.84,52,3549,707,1551,714,3.6912,
         -122.26,37.85,52,2202,434,910,402,3.2031,
         -122.26,37.85,52,3503,752,1504,734,3.2705,
         -122.26,37.85,52,2491,474,1098,468,3.075,
         -122.26,37.84,52,696,191,345,174,2.6736,
         -122.26,37.85,52,2643,626,1212,620,1.9167,
         -122.26,37.85,50,1120,283,697,264,2.125,
         -122.27,37.85,52,1966,347,793,331,2.775,
         -122.27,37.85,52,1228,293,648,303,2.1202,
         -122.26,37.84,50,2239,455,990,419,1.9911,
         -122.27,37.84,52,1503,298,690,275,2.6033,
         -122.27,37.85,40,751,184,409,166,1.3578,
         -122.27,37.85,42,1639,367,929,366,1.7135,
         -122.27,37.84,52,2436,541,1015,478,1.725,
         -122.27,37.84,52,1688,337,853,325,2.1806,
         -122.27,37.84,52,2224,437,1006,422,2.6,
         -122.28,37.85,41,535,123,317,119,2.4038,
         -122.28,37.85,49,1130,244,607,239,2.4597,
         -122.28,37.85,52,1898,421,1102,397,1.808,
         -122.28,37.84,50,2082,492,1131,473,1.6424,
         -122.28,37.84,52,729,160,395,155,1.6875,
         -122.28,37.84,49,1916,447,863,378,1.9274,
         -122.28,37.84,52,2153,481,1168,441,1.9615,
         -122.27,37.84,48,1922,409,1026,335,1.7969,
         -122.27,37.83,49,1655,366,754,329,1.375,
         -122.27,37.83,51,2665,574,1258,536,2.7303,
         -122.27,37.83,49,1215,282,570,264,1.4861,
         -122.27,37.83,48,1798,432,987,374,1.0972,
         -122.28,37.83,52,1511,390,901,403,1.4103,
         -122.26,37.83,52,1470,330,689,309,3.48,
         -122.26,37.83,52,2432,715,1377,696,2.5898,
         -122.26,37.83,52,1665,419,946,395,2.0978,
         -122.26,37.83,51,936,311,517,249,1.2852,
         -122.26,37.84,49,713,202,462,189,1.025,
         -122.26,37.84,52,950,202,467,198,3.9643,
         -122.26,37.83,52,1443,311,660,292,3.0125,
         -122.26,37.83,52,1656,420,718,382,2.6768,
         -122.26,37.83,50,1125,322,616,304,2.026,
         -122.27,37.82,43,1007,312,558,253,1.7348,
         -122.26,37.82,40,624,195,423,160,0.9506,
         -122.27,37.82,40,946,375,700,352,1.775;

    y << 452600,358500,352100,341300,342200,269700,
         299200,241400,226700,261100,281500,241800,
         213500,191300,159200,140000,152500,155500,
         158700,162900,147500,159800,113900,99700,
         132600,107500,93800,105500,108900,132000,
         122300,115200,110400,104900,109700,97200,
         104500,103900,191400,176000,155400,150000,
         118800,188800,184400,182300,142500,137500,
         187500,112500;

    // Normalize features
    VectorXd mean = X.colwise().mean();
    VectorXd sd = ((X.rowwise() - mean.transpose()).array().square().colwise().sum() / X.rows()).sqrt();

    MatrixXd X_norm = (X.rowwise() - mean.transpose()).array().rowwise() / sd.transpose().array();

    // Initialize parameters
    VectorXd W = VectorXd::Zero(X.cols());
    double b = 0.0;

    // Hyperparameters
    double alpha = 0.01;
    int iterations = 100000;

    // Gradient Descent
    for(int it = 0; it < iterations; it++) {
        VectorXd y_hat = X_norm * W + VectorXd::Ones(X_norm.rows()) * b;
        VectorXd error = y_hat - y;
        VectorXd dW = (X_norm.transpose() * error) / X_norm.rows();
        double db = error.mean();
        W -= alpha * dW;
        b -= alpha * db;
    }

    // Prediction example
    VectorXd x_test(8);
    x_test << -122.22,37.8,52,2183,465,1129,460,3.2632;
    VectorXd x_test_norm = (x_test - mean).array() / sd.array();
    double y_pred = x_test_norm.dot(W) + b;

    cout << "Predicted Price: " << y_pred << endl;

    auto end = chrono::high_resolution_clock::now();
    chrono::duration<double> duration = end - start;
    cout << "Time taken by Eigen code: " << duration.count() << " seconds" << endl;

    return 0;
}
